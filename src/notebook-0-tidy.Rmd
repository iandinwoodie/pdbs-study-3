---
title: "Building Tidy Data"
author: "Ian Dinwoodie"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
knitr::opts_chunk$set(echo=TRUE)
```

# Overview

This notebook serves as reference for the tidying procedures used to prepare the
study data for analysis.

# Loading the Data

We start the tidying process from the manually cleaned data set
(`data/manually-cleaned.csv`) since it is structured and coded appropriately.
Explanations for the various stages of the study data are available in the data
directory README file (`data/README.md`).

```{r}
# TODO: Replace "manually-cleaned-mock.csv" with "manually-cleaned.csv" when it
# is available.
df <- read.csv('../data/manually-cleaned-mock.csv', header=TRUE, skipNul=TRUE)
stopifnot(identical(dim(df)+0, c(2318, 484)))
str(df, list.len=10)
```

Our starting data set is 2318 rows (completed dog entries) by 484 columns (data
fields per dog). A list of improved column names focused on readability has been
provided in the reference directory (`references/readable-column-names.csv`).
Let's load and apply these updated names to our data frame.

```{r}
colnames(df) <- read_lines('../references/readable-column-names.csv')
str(df, list.len=10)
```

# Isolate Minimal Data Set

Our first priority is to isolate the minimal data set for this study.

## Drop Unnecessary Columns

A list of the necessary columns for tidying the data has been provided in the
reference directory (`references/columns-for-tidying.csv`). Let's load this file
and drop any unmentioned columns.

```{r}
necessary_cols <- read_lines('../references/columns-for-tidying.csv')
df <- df %>% select(one_of(necessary_cols))
stopifnot(identical(dim(df)+0, c(2318, 274)))
str(df, list.len=10)
```

The number of columns is reduced by about 43% and the number of rows remains the
same (as expected).

## Drop Entires Without Fear/Anxiety

For this study we are investigating fear and anxiety, therefore, we only need to
retain entries relevant to that goal. We use the fear/anxiety binary indicator
to determine which entries should be kept.

```{r}
df <- df %>%
  filter(has_exhibited_fear_anxiety == 1) %>%
  select(-has_exhibited_fear_anxiety)
stopifnot(identical(dim(df)+0, c(1305, 273)))
dim(df)
```

We see that there are entries for 1305 fearful and/or anxious dogs in the data
set and the column count has decremented to 273 as a result of dropping the
fear/anxiety indicator.

# Final Summary

Take a last look at the data before saving it to disk.

```{r}
dim(df)
summary(df)
```

# Saving the Tidy Data

Save the data to a file in the data directory using RDS format so that the data
types are saved and the resulting file is compressed.

```{r}
saveRDS(df, '../data/tidy.Rds')
```
