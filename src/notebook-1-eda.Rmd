---
title: "Exploratory Data Analysis (EDA)"
author: "Ian Dinwoodie"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo=TRUE)
```

# Loading the Tidy Data

Load the tidy data from disk.

```{r}
df <- readRDS('../build/tidy.Rds')
stopifnot(identical(dim(df)+0, c(1308, 266)))
str(df, list.len=5)
```

# Descriptive Stats

## Households

Get the nunber of participating dog owners.

```{r}
length(unique(df$owner_id))
```

Determine the median number of dogs per household.

```{r}
summary(as.data.frame(table(df$owner_id))$Freq)
```

## Gender and Neuter Status

```{r}
tbl <- as.numeric(table(df$is_male))
male_cnt <- tbl[2]
female_cnt <- tbl[1]
rm(tbl)

male_prop <- round(male_cnt / (male_cnt + female_cnt) * 100, 2)
print(paste0("Males: ", male_cnt, " (", male_prop, "%)"))
print(paste0("Females: ", female_cnt, " (", 100-male_prop, "%)"))
rm(male_prop)
```

```{r}
tbl <- xtabs(~is_male+is_neutered,data=df)
male_neutered_cnt <- tbl[4]
female_neutered_cnt <- tbl[3]
rm(tbl)

male_neutered_prop <- round(male_neutered_cnt / male_cnt * 100, 2)
print(paste0("Males that are neutered: ", male_neutered_cnt, " (",
             male_neutered_prop, "%)"))
rm(male_cnt, male_neutered_cnt, male_neutered_prop)

female_neutered_prop <- round(female_neutered_cnt / female_cnt * 100, 2)
print(paste0("Females that are neutered: ", female_neutered_cnt, " (",
             female_neutered_prop, "%)"))
rm(female_cnt, female_neutered_cnt, female_neutered_prop)
```

## Ages

```{r}
display_median_with_range <- function(col) {
  col_min <- min(col, na.rm=TRUE)
  col_max <- max(col, na.rm=TRUE)
  col_median <- median(col, na.rm=TRUE)
  col_cnt <- sum(!is.na(col))
  print(paste0("median=", col_median, " (range: ", col_min, " to ", col_max,
               ") (n=", col_cnt, ")"))
}

print("Age at time of study (in months)")
display_median_with_range(df$cur_age_in_mos)
```

```{r}
print("Age at time of acquisition (in months)")
display_median_with_range(df$acq_age_in_mos)
```

```{r}
print("Age at time of neuter (in months)")
display_median_with_range(df$neuter_age_in_mos)
```

## Fear/Anxiety Frequencies

```{r}
# Bin fear/anxiety types into categories.
# bins: {inanimate, animate, situational, generalized, ptsd}
# 2 + 1 + 5 + 1 + 1 = 10
df$thunderstorm_phobia_rating <- as.integer(df$thunderstorm_phobia_rating)
df$non_thunderstorm_noise_phobia_rating <- as.integer(df$non_thunderstorm_noise_phobia_rating)
df$inanimate_rating <- rowMeans(
  subset(df, select = c(
    thunderstorm_phobia_rating,
    non_thunderstorm_noise_phobia_rating)), na.rm = TRUE)
print(count(df$inanimate_rating > 0))
print(round(614 / 1308 * 100, 2))
```

```{r}
df$fear_of_other_dogs_rating <- as.integer(df$fear_of_other_dogs_rating)
df$animate_rating <- rowMeans(
  subset(df, select = c(fear_of_other_dogs_rating)), na.rm = TRUE)
print(count(df$animate_rating > 0))
print(round(319 / 1308 * 100, 2))
```

```{r}
df$crowd_phobia_rating <- as.integer(df$crowd_phobia_rating)
df$situation_anxiety_rating <- as.integer(df$situation_anxiety_rating)
df$veterinary_anxiety_rating <- as.integer(df$veterinary_anxiety_rating)
df$separation_anxiety_rating <- as.integer(df$separation_anxiety_rating)
df$anxiety_in_the_car_rating <- as.integer(df$anxiety_in_the_car_rating)
df$situational_rating <- rowMeans(
  subset(df, select = c(
    crowd_phobia_rating,
    situation_anxiety_rating,
    veterinary_anxiety_rating,
    separation_anxiety_rating,
    anxiety_in_the_car_rating
  )), na.rm = TRUE)
print(count(df$situational_rating > 0))
print(round(1079 / 1308 * 100, 2))
```

```{r}
df$general_anxiety_rating <- as.integer(df$general_anxiety_rating)
df$generalized_rating <- rowMeans(
  subset(df, select = c(general_anxiety_rating)), na.rm = TRUE)
print(count(df$generalized_rating > 0))
print(round(273 / 1308 * 100, 2))
```

```{r}
df$ptsd_rating <- as.integer(df$ptsd_rating)
df$ptsd_rating <- rowMeans(subset(df, select = c(ptsd_rating)), na.rm = TRUE)
print(count(df$ptsd_rating > 0))
print(round(132 / 1308 * 100, 2))
```

```{r}
df$other_fear_anxiety_rating <- as.integer(df$other_fear_anxiety_rating)
df$fa_overall_rating <- rowMeans(
  subset(df, select = c(
    thunderstorm_phobia_rating,
    non_thunderstorm_noise_phobia_rating,
    fear_of_other_dogs_rating,
    crowd_phobia_rating,
    situation_anxiety_rating,
    veterinary_anxiety_rating,
    separation_anxiety_rating,
    anxiety_in_the_car_rating,
    general_anxiety_rating,
    ptsd_rating,
    other_fear_anxiety_rating
  )), na.rm = TRUE)
count(df$fa_overall_rating)
print(count(df$fa_overall_rating >= 0))
print(round(1252 / 1308 * 100, 2))
```




