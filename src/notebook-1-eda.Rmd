---
title: "Exploratory Data Analysis (EDA)"
author: "Ian Dinwoodie"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo=TRUE)
```

# Loading the Tidy Data

Load the tidy data from disk.

```{r}
df <- readRDS('../build/tidy.Rds')
stopifnot(identical(dim(df)+0, c(1308, 260)))
str(df, list.len=5)
```

# Descriptive Stats

## Households

Get the nunber of participating dog owners.

```{r}
length(unique(df$owner_id))
```

Determine the median number of dogs per household.

```{r}
summary(as.data.frame(table(df$owner_id))$Freq)
```

## Gender and Neuter Status

```{r}
tbl <- as.numeric(table(df$is_male))
male_cnt <- tbl[2]
female_cnt <- tbl[1]
rm(tbl)

male_prop <- round(male_cnt / (male_cnt + female_cnt) * 100, 2)
print(paste0("Males: ", male_cnt, " (", male_prop, "%)"))
print(paste0("Females: ", female_cnt, " (", 100-male_prop, "%)"))
rm(male_prop)
```

```{r}
tbl <- xtabs(~is_male+is_neutered,data=df)
male_neutered_cnt <- tbl[4]
female_neutered_cnt <- tbl[3]
rm(tbl)

male_neutered_prop <- round(male_neutered_cnt / male_cnt * 100, 2)
print(paste0("Males that are neutered: ", male_neutered_cnt, " (",
             male_neutered_prop, "%)"))
rm(male_cnt, male_neutered_cnt, male_neutered_prop)

female_neutered_prop <- round(female_neutered_cnt / female_cnt * 100, 2)
print(paste0("Females that are neutered: ", female_neutered_cnt, " (",
             female_neutered_prop, "%)"))
rm(female_cnt, female_neutered_cnt, female_neutered_prop)
```

## Ages

```{r}
display_median_with_range <- function(col) {
  col_min <- min(col, na.rm=TRUE)
  col_max <- max(col, na.rm=TRUE)
  col_median <- median(col, na.rm=TRUE)
  col_cnt <- sum(!is.na(col))
  print(paste0("median=", col_median, " (range: ", col_min, " to ", col_max,
               ") (n=", col_cnt, ")"))
}

print("Age at time of study (in months)")
display_median_with_range(df$cur_age_in_mos)
```

```{r}
print("Age at time of acquisition (in months)")
display_median_with_range(df$acq_age_in_mos)
```

```{r}
print("Age at time of neuter (in months)")
display_median_with_range(df$neuter_age_in_mos)
```

## Fear/Anxiety Frequencies

```{r}
cnt <- sum(!is.na(df$inanimate_rating))
proportion <- round(cnt / dim(df)[1] * 100, 2)
print(paste0("inanimate=", cnt, " (", proportion, "%)"))
```

```{r}
cnt <- sum(!is.na(df$animate_rating))
proportion <- round(cnt / dim(df)[1] * 100, 2)
print(paste0("animate=", cnt, " (", proportion, "%)"))
```

```{r}
cnt <- sum(!is.na(df$situational_rating))
proportion <- round(cnt / dim(df)[1] * 100, 2)
print(paste0("situational=", cnt, " (", proportion, "%)"))
```

```{r}
cnt <- sum(!is.na(df$generalized_rating))
proportion <- round(cnt / dim(df)[1] * 100, 2)
print(paste0("generalized=", cnt, " (", proportion, "%)"))
```

```{r}
cnt <- sum(!is.na(df$ptsd_rating))
proportion <- round(cnt / dim(df)[1] * 100, 2)
print(paste0("ptsd=", cnt, " (", proportion, "%)"))
```

```{r}
cnt <- sum(!is.na(df$fa_overall_rating))
proportion <- round(cnt / dim(df)[1] * 100, 2)
print(paste0("fa_overall=", cnt, " (", proportion, "%)"))
```

# Acquisition Source

```{r}
df %>%
  filter(!is.na(acquisition_source)) %>%
  group_by(acquisition_source) %>%
  summarise(n=n()) %>%
  arrange(desc(n))
```

# Purebred Breed

```{r}
df %>%
  filter(!is.na(purebred_breed)) %>%
  group_by(purebred_breed) %>%
  summarise(n=n()) %>%
  arrange(desc(n))
```

# Save Session Info

```{r}
sessionInfo()
```
