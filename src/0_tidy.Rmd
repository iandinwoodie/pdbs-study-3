---
title: "Building Tidy Data"
author: "Ian Dinwoodie"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
knitr::opts_chunk$set(echo=TRUE)
```

# Loading the Data

The raw data is included in the data directory (i.e., `data/raw.csv`). However,
since some data needed to be cleaned manually, we start from the manually
cleaned data. We load the data and verify its dimensions and structure.

```{r}
# TODO: Replace "mock-manual.csv" with "manual.csv" when it is available.
df <- read.csv('../data/mock-manual.csv', header=TRUE, skipNul=TRUE)
dim(df)
str(df, list.len=25)
```

We see that we have 2318 responses across 484 fields.

## Drop Unnecessary Columns

Let's drop some unnecessary columns which will in turn make the data set more
manageable.

```{r}
drop_patterns <- c(
  '^record_id$',
  '^dog_name$',
  '^q([0-9][1,3,5-9]|[1-9][0-9])_.*$',
  '^q02_main_([3-9]|[0-9]{2})$',
  '^q02_score$',
  '^q04_count$',
  '^aggression_.*$',
  '^repbeh_nmed_.*$',
  '^repbeh_wmed_.*$',
  '^soiling_.*$',
  '^marking_.*$',
  '^excited_.*$',
  '^barking_.*$',
  '^jumping_.*$',
  '^mounting_.*$',
  '^feces_.*$',
  '^destructive_.*$',
  '^disgust_.*$',
  '^escape_.*$'
)
drop_pattern_str <- paste(drop_patterns, collapse='|')
drop_idx <- grep(drop_pattern_str, names(df))
df <- df[, -drop_idx]
dim(df)
str(df, list.len=25)
```

Now we are working with 2318 responses across 275 columns.

## Isolate Fearful and/or Anxious Dog Responses

For this study we are investigating fear and anxiety, so we retain only the
records relevant to that goal.

```{r}
df <- filter(df, q02_main_2 == 1)
df <- subset(df, select=-c(q02_main_2))
dim(df)
```

We have 1305 fearful and/or anxious dog responses across 274 columns (after
dropping the fear/anxiety indicator).

# Final Summary

Take a last look at the data before saving it to disk.

```{r}
dim(df)
summary(df)
```

# Saving the Tidy Data

Save the data to a file in RDS format so that the data types are saved and so
that the output is compressed.

```{r}
saveRDS(df, '../data/tidy.Rds')
```
